<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>ES6之Map</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
</head>
<body>
<h2>ES6之Map</h2>
<h3>一、概述</h3>
<p>ES6新增了四种数据集Map、Set、WeakMap、WeakSet。</p>
<h4>1.1、Map</h4>
<p>Map用来存储键值对，Map的键可以是任意类型，这一点比JSON还是强大的：</p>
<p><img src="http://i.imgur.com/2JGMjFc.png" /></p>
<p>可以使用拥有[key,value]键值对的数组或者其它可迭代的东西来新建map对象。</p>
<h4>1.2、Set</h4>
<p>Set是包含独一无二的元素的集合，它的一个最明显的用处就是数组去重：</p>
<p><img src="http://i.imgur.com/fU0IZmt.png" /></p>
<p>它的牛逼之处就在于它能去重NaN和undefined</p>
<h3>二、Map</h3>
<p>JavaScript是一个强大的库，但是可惜的是缺乏一个进行值与值映射的数据结构。ES5中可以使用对象来实现，但是这种方法实际上是对对象的滥用。ES6中的Map可以使用任意值作为键。</p>
<h4>2.1、基本操作</h4>
<p>基本操作主要是new Map, get, set, has, delete, clear以及size属性检查大小。如下：</p>
<p><img src="http://i.imgur.com/KkjFHqQ.png" /></p>
<h4>2.2、设置Map</h4>
<p>可以使用键值对的迭代器来设置Map,更为普遍的是使用元素是[key, value]的数组来设置：</p>
<p><img src="http://i.imgur.com/SYWl3Pl.png" /></p>
<p>当然也可以链式调用set来实现：</p>
<p><img src="http://i.imgur.com/L6MDdsZ.png" /></p>
<h4>2.3、Key</h4>
<h5>2.3.1、什么样的额值可以作为key呢？</h5>
<p>任意数据类型都可以作为key，甚至对象也可以作为key</p>
<p><img src="http://i.imgur.com/56FgrBe.png" /></p>
<h5>2.3.2、什么样的key会被认为相等呢？</h5>
<p>大部分Map操作都需要判断某个值是否等于key，它在内部使用的是一个叫做<code>SameValueZero</code>的操作，和===类似，只不过前者认为NaN与自身相等：</p>
<p><img src="http://i.imgur.com/UFIRWNr.png" /></p>
<p>同样，+0和-0也被认为相等（和常识一致）：</p>
<p><img src="http://i.imgur.com/5RwEoSv.png" /></p>
<p>任意两个对象都会被认为不同，如果get找不到某个键，它将返回undefined</p>
<h4>2.4、迭代</h4>
<p>当对Map进行迭代时，元素将会以创建的顺序进行迭代。</p>
<h5>2.4.1、对key迭代</h5>
<p><img src="http://i.imgur.com/wX4DaDS.png" /></p>
<h5>2.4.2、对value进行迭代</h5>
<p><img src="http://i.imgur.com/BoNRdxt.png" /></p>
<h5>2.4.3、对整体进行迭代</h5>
<p><img src="http://i.imgur.com/0zh3nTU.png" /></p>
<p>注意entries迭代器返回的是数组形式的[key, value]，而不是{key, value}。
这也与创建Map时，必须使用数组形式的[key, value]，而不能是对象形式{key, value}相呼应</p>
<p>默认的迭代方式就是entries,证明如下：</p>
<p><img src="http://i.imgur.com/T4hQ6H8.png" /></p>
<p>也就是说前面的代码可以简化如下：</p>
<p><img src="http://i.imgur.com/7GvqS6w.png" /></p>
<h5>2.4.4、解构回数组</h5>
<p>可以通过解构将keys迭代器、valus迭代器、entries（同map）迭代器解构回数组：</p>
<p><img src="http://i.imgur.com/WPSJKYI.png" /></p>
<h4>2.5、forEach遍历Map</h4>
<p>Map的forEach签名如下：</p>
<p>Map.prototype.forEach((value, key, map) =&gt; void, thisArgs?):void</p>
<p>可以使用forEach进行Map遍历：</p>
<p><img src="http://i.imgur.com/tAgock5.png" /></p>
<h4>2.6、map以及filter Map</h4>
<p>数组拥有map和filter方法，但是Map并不拥有，那么要想映射Map,怎么办呢？</p>
<ol>
<li>将Map转换为数组</li>
<li>map或者filter改数组</li>
<li>将数组转换成Map</li>
</ol>
<p><img src="http://i.imgur.com/XUNCKIZ.png" /></p>
<h4>2.7、合并Map</h4>
<p>Map也没有类似数组的concat方法，因此仍然需要三步：</p>
<ol>
<li>转换成数组</li>
<li>调用concat或连续解构</li>
<li>转换回Map</li>
</ol>
<p><img src="http://i.imgur.com/dL2OIQP.png" /></p>
<h4>2.8、Map的相关API</h4>
<h5>2.8.1、构造函数API</h5>
<p><img src="http://i.imgur.com/dBZEHVg.png" /></p>
<h5>2.8.2、处理单个实体的API</h5>
<p><img src="http://i.imgur.com/lHpP0Yt.png" /></p>
<h5>2.8.2、处理多个实体的API</h5>
<p><img src="http://i.imgur.com/IZLLjDP.png" />
<img src="http://i.imgur.com/62wl6UB.png" /></p>
<h5>2.8.2、迭代API</h5>
<p><img src="http://i.imgur.com/1IRCjpo.png" /></p>
<h3>三、WeakMap</h3>
<p>WeakMap不会阻止它的键被垃圾回收，这意味着可以将私有数据与对象关联，而不必担心内存泄露。也就是说可以将this作为WeakMap的键，数据作为值来构造私有数据。</p>
<p>我们来看看原话是怎么说的：</p>
<blockquote>
<p>A WeakMap is a Map that doesn’t prevent its keys from being garbage-collected. That means thatyou can associate data with objects without having to worry about memory leaks</p>
</blockquote>
<p>WeakMap和Map有重要区别</p>
<ol>
<li>WeakMap的key只能是对象，value仍然可以是任意值</li>
<li>WeakMap不允许keys,values,entries任意形式的迭代</li>
<li>WeakMap不允许clear()</li>
</ol>
<p>WeakMap的这些限制的原意在于：</p>
<ol>
<li>WeakMap的易变性/暂存性（volatility）使其不易实现迭代</li>
<li>不能clear可以确保安全。WeakMap只能够被同时拥有该WeakMap以及key的人操作，如果提供clear(),那么任意一个人，只要他拥有该WeakMap，他就可以操作了，这样不是很安全。</li>
</ol>
<blockquote>
<p>“The mapping from
weakmap/key pair value can only be observed or affected by someone who has both theweakmap and the key. With clear(), someone with only the WeakMap would’ve been ableto affect the WeakMap-and-key-to-value mapping</p>
</blockquote>
<p>WeakMap可以用作为对象提供私有数据和方法：</p>
<p><img src="http://i.imgur.com/AJmvrJi.png" /></p>
<p>WeakMap所拥有的API有下面几个：</p>
<p><img src="http://i.imgur.com/bgUnykU.png" /></p>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
